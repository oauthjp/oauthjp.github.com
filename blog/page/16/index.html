
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>OAuth.jp</title>
    <meta name="author" content="Nov Matake">
    
	<meta name="description" content="Author: Nov Matake Date: Feb 8th, 2012 昨日の続き。「ソーシャルゲームなんて3000万人の特殊な人しかやってない」という意見もあるようなので、今日は iOS アプリ版。 登場人物 iOS SDK 出してるプラットフォーム
iOS SDK &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="OAuth.jp" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='http://fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->
    <!-- <script src="/javascripts/ajaxify.js"></script> -->

    
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-55348-17', 'auto');
  ga('send', 'pageview');
</script>

</head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
  <a href='/'>
    <div id="headerbg">
      OAuth.jp
    </div>
  </a>
</h1>
<br>

<ul id="social-links" style="text-align:center">
  
  <!-- Facebook -->
  <li>
  <a href="http://www.facebook.com/oauth.jp" class="facebook" title="Facebook"></a>
  </li>
  
  
  <!-- Twitter -->
  <li>
  <a href="http://www.twitter.com/oauthjp" class="twitter" title="Twitter"></a>
  </li>
  
  
  <!-- GitHub -->
  <li>
  <a href="https://github.com/nov" class="github" title="Github"></a>
  </li>
  
  
  
  
  
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
  
</ul>




</header>

<div id="toload">
<!-- begin toload --> 
    <div id="content" class="inner">
        


    <article class="post">
  <h2 class="title">
    
    <a href="/blog/2012/02/08/ios-sdk/">
    
      &#8220;なんちゃら iOS SDK&#8221; でありそうな被害例</a>
  </h2>
  <div class="entry-content">
    <div class="meta">
  <div class="author">
    Author: <a href="http://matake.jp">Nov Matake</a>
  </div>
  <div class="date">Date: 








  


<time datetime="2012-02-08T00:00:00+09:00" pubdate data-updated="true">Feb 8<span>th</span>, 2012</time></div>
  
</div>

    <p><a href="/blog/2012/02/07/oauth-20-implicit-flow">昨日の</a>続き。「ソーシャルゲームなんて3000万人の特殊な人しかやってない」という意見もあるようなので、今日は iOS アプリ版。</p>


<h3>登場人物</h3>


<ul><li>iOS SDK 出してるプラットフォーム</li>
<li>iOS SDK と連携するプラットフォームの公式 iOS アプリ</li>
<li>プラットフォーム上で “まっとうな” アプリを運営してる攻撃者</li>
<li>攻撃者が自作した攻撃用アプリ</li>
<li>iOS SDK 使って開発された被害アプリ</li>
<li>あいかわらず無邪気な被害ユーザ</li>
</ul>


<h3>前提</h3>


<p>プラットフォームが提供する iOS SDK は、</p>


<ol><li>プラットフォームが指定するカスタムスキーマ (ex. “xyz-connect://”) で始まる URI にアクセスすることで</li>
<li>プラットフォーム公式 iOS アプリに access token 取得のフローを delegate し</li>
<li>公式アプリが被害アプリの指定するカスタムスキーマ (ex. “foobar-rowial://”) で始まる URI にユーザーを戻すことで、アプリに access token を返す。</li>
</ol>


<p>被害アプリは、</p>


<ol><li>iOS SDK から受け取った access token を自身のバックエンドサーバに送り</li>
<li>バックエンドサーバはプラットフォームが提供する Profile API (GET /me とか) にアクセスして</li>
<li>レスポンスに含まれる user_id をもとにユーザを認証する。</li>
</ol>


<h3>シナリオ</h3>


<ol><li>攻撃者はプラットフォームが指定するのと同じカスタムスキーマで delegate を受け取る攻撃用アプリを自作する (なり誰かから買うなり..)</li>
<li>攻撃者は自分の iPhone/iPad に攻撃用アプリをインストール (xcode 経由だと、Apple の承認必要ないんですよね、たしか？)</li>
<li>攻撃者は自分が運営する “まっとうな” なアプリの DB から被害ユーザのアクセストークンを取って来て攻撃用アプリに埋め込む</li>
<li>攻撃者は被害アプリを起動して “なんちゃら ID でログイン” とかいうボタンを押す</li>
<li>被害アプリはプラットフォーム攻撃者が自作した攻撃用アプリに delegate 開始</li>
<li>攻撃用アプリは被害ユーザのアクセストークンを被害アプリに返す</li>
<li>攻撃者は被害ユーザのアカウントで被害アプリを使う</li>
</ol>


<h3>対策方法</h3>


<p>プラットフォームの iOS SDK は “response_type=token code” に対応する。</p>


<p>被害アプリは、”response_type=token code” を使い、サーバーサイドへは access token ではなく authorization code を送る。(そしてサーバーサイドでは client authentication して code を token と交換する)</p>


<p>ただいかんせんプラットフォーム側の iOS SDK が対応してくれなかったり、既にアプリを公開していて古いバージョンもサポートしなければならなかったりすることもあるので、そういう場合はバックエンドサーバーで対応。</p>


<p>被害アプリのバックエンドサーバは、どうしてもアプリ側から access token を受け取らざるを得ないのであれば、<a href="/blog/2012/02/07/oauth-20-implicit-flow">昨日の記事</a>と同様に access token 発行先アプリが自身であることを確認する。</p>


<h3>追記</h3>


<p>いくつか気になるtweetがあったので、載せときます。</p>


<blockquote class="twitter-tweet">
<p>@<a href="https://twitter.com/7032">7032</a> 「そもそもそれ認証関係お任せライブラリでは無いから、勘違いするとこういう目にあうよ。」という話です。</p>
<div><a href="https://twitter.com/oauthjp/status/167406152261443584">February 9, 2012</a></div>
</blockquote>


<blockquote class="twitter-tweet">
<p>@<a href="https://twitter.com/7032">7032</a> コンポーネントというのがiOS SDKのことを指してるなら、それはちゃんと認可リクエストも送ってるしそのレスポンスも受け取ってるので、OAuthの仕様の範囲内では正常に動作しています。受け取ったトークンが、そもそも認証のために使えるものである保証が無いというだけです。</p>
<div><a href="https://twitter.com/oauthjp/status/167439399196426240">February 9, 2012</a></div>
</blockquote>


    
    
  </div>

<div class="meta">
  
</div>
</article>


    <article class="post">
  <h2 class="title">
    
    <a href="/blog/2012/02/07/oauth-20-implicit-flow/">
    
      「OAuth 2.0 (Implicit Flow) でログイン」の被害例</a>
  </h2>
  <div class="entry-content">
    <div class="meta">
  <div class="author">
    Author: <a href="http://matake.jp">Nov Matake</a>
  </div>
  <div class="date">Date: 








  


<time datetime="2012-02-07T00:00:00+09:00" pubdate data-updated="true">Feb 7<span>th</span>, 2012</time></div>
  
</div>

    <h3>。登場人物</h3>


<ul><li>OAuth 2.0対応してる某ゲームプラットフォーム</li>
<li>某ゲームプラットフォーム上で占いゲームを運営してる攻撃者</li>
<li>某ゲームプラットフォーム上で運営されてる農園ゲーム（= 被害アプリ）</li>
<li>某ゲームプラットフォーム上で無邪気に遊んでる被害ユーザ</li>
</ul>


<p>※ 念のため、今回の話は特にゲームに限った話ではない。</p>


<h3>前提</h3>


<p>某ゲームプラットフォーム、農園ゲーム共に、XSS とか CSRF とかセッションハイジャックされるような脆弱性はない。</p>


<p>農園ゲームはプラットフォームが発行するAccess TokenをOAuth 2.0のImplicit Flowを使って受け取り、同じくプラットフォームが提供するProfile API (GET /me とか) にアクセスして、レスポンスに含まれる user_id をもとにユーザを認証している。</p>


<p>攻撃者は占いゲームのDBから任意のAccess Tokenを取得可能。</p>


<h3>シナリオ</h3>


<ol><li>被害ユーザが占いゲームに登録 (= 占いゲームに対するAccess Tokenが発行される)</li>
<li>攻撃者が農園ゲームにアクセス、Authorization Flow開始</li>
<li>攻撃者が某ゲームプラットフォーム -&gt; 農園ゲームへのRedirect Responseを中断させる</li>
<li>攻撃者がFragment中のAccess Tokenを占いゲームのDBから持ってきた被害者のAccess Tokenに置き換え</li>
<li>農園ゲームは受け取ったAccess Tokenをもとに、攻撃者を被害ユーザとして認証</li>
<li>攻撃者が被害ユーザとして農園ゲームで遊ぶ</li>
</ol>


<h3>対策方法</h3>


<p>農園ゲームの開発者は、受け取ったAccess Tokenが農園ゲームに対して発行されたものであることを確認すること。占いゲームに対して発行されたAccess Tokenを受け入れないこと。</p>


<p>プラットフォームがFacebookの場合なら、以下のリクエストを行うことで、Access Tokenがどのクライアントに発行されたものかを検証可能。</p>


<div class="CodeRay">
  <div class="code"><pre>GET /app
Authorization: OAuth replace_with_your_access_token</pre></div>
</div>




<p>急募&#160;: 他のプラットフォームの場合の対応策</p>


<h3>参考文献</h3>


<ul><li><a href="http://www.sakimura.org/2012/02/1487/">単なる OAuth 2.0 を認証に使うと、車が通れるほどのどでかいセキュリティー・ホールができる</a></li>
<li><a href="http://d.hatena.ne.jp/ritou/20120206/1328484575">OAuth 2.0 Implicit Flowをユーザー認証に利用する際のリスクと対策方法について #idcon</a></li>
</ul>


    
    
  </div>

<div class="meta">
  
</div>
</article>


    <article class="post">
  <h2 class="title">
    
    <a href="/blog/2012/01/24/oauth-20-core-bearer-ietf-last-call/">
    
      OAuth 2.0 Core & Bearer が IETF Last Call に！</a>
  </h2>
  <div class="entry-content">
    <div class="meta">
  <div class="author">
    Author: <a href="http://matake.jp">Nov Matake</a>
  </div>
  <div class="date">Date: 








  


<time datetime="2012-01-24T00:00:00+09:00" pubdate data-updated="true">Jan 24<span>th</span>, 2012</time></div>
  
</div>

    <p>昨晩、IETF OAuth WG ML で、OAuth 2.0 Core &amp; Bearer の2つの仕様が IETF Last Call に入ったことが通知されました。</p>


<p><a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08285.html"><a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08285.html">http://www.ietf.org/mail-archive/web/oauth/current/msg08285.html</a></a></p>


<p><a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08286.html"><a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08286.html">http://www.ietf.org/mail-archive/web/oauth/current/msg08286.html</a></a></p>


<p>今後は IETF のルールに乗っ取って、RFC 化までの作業が進められます。</p>


<p>ちょうど以下のメールで IETF Last Call から RFC 化までの流れが説明されていたので、翻訳しておきます。</p>


<p><a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08292.html"><a href="http://www.ietf.org/mail-archive/web/oauth/current/msg08292.html">http://www.ietf.org/mail-archive/web/oauth/current/msg08292.html</a></a></p>


<blockquote>
<p>1. IETF Last Call, which lasts two weeks. This is essentially your last opportunity to provide feedback!</p>
<p>IETF Last Call では、2週間で結論が出る。本質的にこの期間がフィードバックを行う最後のチャンスである。</p>
<p>2. During IETF Last Call, the documents will be reviewed by several cross-area teams within the IETF, including folks like the &#8220;GEN-ART&#8221; review team and the AppsDir. We&#8217;ll expect at least some feedback from those teams. And at this stage anyone in the Internet community can provide feedback, too.</p>
<p>IETF Last Call 期間中、仕様書は &#8220;GEN-ART&#8221; レビューチームや AppsDir を含む IETF 内の複数エリアのチームにレビューされる。少なくともこれらのチームからは何らかのフィードバックが得られるであろう。もちろんこのステージでも Internet community の全員にフィードバックを行う権利がある。</p>
<p>3. After IETF Last Call, this WG&#8217;s document editors will work to address any feedback we&#8217;ve received.</p>
<p>IETF Last Call 後、Working Group 仕様書編集者は受け取ったすべてのフィードバックに対応する。</p>
<p>4. The documents will then be scheduled for disussion during an IESG telechat. Before the telechat, all the members of the Internet Engineering Steering Group will review the specs and also provide feedback. If there are &#8220;DISCUSSES&#8221; and &#8220;COMMENTS&#8221; lodged then the document editors will need to address those (often in concert with the WG chairs). If some of those issues are substantive, the editors and chairs might bring those issues back to the WG for more discussion.</p>
<p>その後、仕様書は IESG の電話会議でのディスカッションにまわされる。この会議の前に、全 IESG メンバーがレビューおよびフィードバックを行う。&#8221;DISCUSSES&#8221; もしくは &#8220;COMMENTS&#8221; が発生した場合は、エディターが (おそらく WG チェアと共に) これらに対応する必要がある。もし問題が大量に発生した場合は、エディターとチェアは再び仕様を WG に差し戻し、WG 内でさらなる議論を行うこともある。</p>
<p>5. Assuming the documents are approved by the IESG, they will then be handed off to the RFC Editor team for final copy editing, proofreading, reference checking, etc.</p>
<p>仕様書が IESG に認可されると、RFC Editor チームの手によって最終的な編集、校正、リファレンスチェックなどが行われる。</p>
</blockquote>


<p>脱デルデル詐欺！</p>


    
    
  </div>

<div class="meta">
  
</div>
</article>


    <article class="post">
  <h2 class="title">
    
    <a href="/blog/2011/11/29/oauth-20-core-bearer-spec-76993/">
    
      OAuth 2.0 Core & Bearer Spec 翻訳公開！</a>
  </h2>
  <div class="entry-content">
    <div class="meta">
  <div class="author">
    Author: <a href="http://matake.jp">Nov Matake</a>
  </div>
  <div class="date">Date: 








  


<time datetime="2011-11-29T00:00:00+09:00" pubdate data-updated="true">Nov 29<span>th</span>, 2011</time></div>
  
</div>

    <p>OAuth 2.0 Core draft 22 &amp; Bearer draft 11 の翻訳版を、<a href="http://openid-foundation-japan.github.com/">OpenID Foundation Japan 翻訳WGのページ</a>で公開しました。</p>


<p>12月〜1月あたりにOAuth 2.0のRFC化も予想されており、これからOAuth 2.0対応APIも増えてくると思います。この翻訳版が、みなさんの参考になれば幸いです。</p>


<p>また、翻訳活動に参加していただいた12名の有志のみなさん (翻訳版の最後の方に翻訳者リストあり)、おつかれさまでした！</p>




<p>Core翻訳版はこちら。</p>


<p><a href="http://openid-foundation-japan.github.com/draft-ietf-oauth-v2-draft22.ja.html">The OAuth 2.0 Authorization Protocol</a></p>


<p>Bearer翻訳版はこちら。</p>


<p><a href="http://openid-foundation-japan.github.com/draft-ietf-oauth-v2-bearer-draft11.ja.html">The OAuth 2.0 Authorization Protocol: Bearer Tokens</a></p>


    
    
  </div>

<div class="meta">
  
</div>
</article>


    <article class="post">
  <h2 class="title">
    
    <a href="/blog/2011/10/29/oauth-20-core-bearer-spec-73921/">
    
      OAuth 2.0 Core & Bearer Spec 翻訳スタート</a>
  </h2>
  <div class="entry-content">
    <div class="meta">
  <div class="author">
    Author: <a href="http://matake.jp">Nov Matake</a>
  </div>
  <div class="date">Date: 








  


<time datetime="2011-10-29T00:00:00+09:00" pubdate data-updated="true">Oct 29<span>th</span>, 2011</time></div>
  
</div>

    <p>@nov です。</p>




<p>先日こちらのサイトでメンバー募集した OAuth 2.0 翻訳プロジェクトですが、26日に Kick-off して27日から実際に翻訳活動をスタートしました。</p>


<p>[Core] <a href="https://github.com/openid-foundation-japan/draft-ietf-oauth"><a href="https://github.com/openid-foundation-japan/draft-ietf-oauth">https://github.com/openid-foundation-japan/draft-ietf-oauth</a></a></p>


<p>[Bearer] <a href="https://github.com/openid-foundation-japan/draft-ietf-oauth-v2-bearer"><a href="https://github.com/openid-foundation-japan/draft-ietf-oauth-v2-bearer">https://github.com/openid-foundation-japan/draft-ietf-oauth-v2-bearer</a></a></p>


<p>11月末の公開に向けて、2〜3週間は毎日少しずつ翻訳が進みます。</p>




<p>しかし、<a href="https://github.com/openid-foundation-japan">OpenID Foundation Japan の Github Organization</a> メンバーが、いつのまにか20人超えていてびっくりです。</p>


    
    
  </div>

<div class="meta">
  
</div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/15/" class="prev">Prev</a>
    
    
        <a href="/blog/page/17/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>

    </div>
    <footer id="footer">
    <div style="display:inline">
  <p>
    Copyright &copy; 2018
    
      <a href="http://matake.jp">Nov Matake</a> - 技術的な相談等、お仕事依頼は <a href="http://yauth.jp">YAuth.jp</a> まで.
    
  </p>
  <p>
    Powered by <a href="http://octopress.org">Octopress</a>.
    Theme <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
  </p>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'oauthjp';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
